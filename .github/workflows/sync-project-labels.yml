name: Sync Project Status to Label

on:
  schedule:
    - cron: '*/5 * * * *'  # Run every 5 minutes
  workflow_dispatch:  # Allow manual trigger

jobs:
  sync-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Sync Project Status to Labels
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const query = `
              query($user:String!, $projectNumber:Int!) {
                user(login: $user) {
                  projectV2(number: $projectNumber) {
                    items(first: 100) {
                      nodes {
                        id
                        content {
                          __typename
                        }
                      }
                    }
                  }
                }
              }
            `;

            try {
              const result = await github.graphql(query, {
                user: context.repo.owner,
                projectNumber: 9
              });

              console.log("GraphQL Result:", JSON.stringify(result, null, 2));
              
            } catch (error) {
              console.error("Error syncing labels:", error.message);
              throw error;
            }
