name: Sync Project Status to Label

on:
  schedule:
    - cron: '*/5 * * * *'  # Run every 5 minutes
  workflow_dispatch:  # Allow manual trigger

jobs:
  sync-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Debug Project Query
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.PERSONAL_TOKEN }}
          script: |
            const query = `
              query($user:String!) {
                user(login: $user) {
                  projectsV2(first: 10) {
                    nodes {
                      id
                      number
                      title
                    }
                  }
                }
              }
            `;

            try {
              const result = await github.graphql(query, {
                user: context.repo.owner
              });

              console.log("User Projects:", JSON.stringify(result, null, 2));
              
            } catch (error) {
              console.error("Error:", error.message);
              throw error;
            }
